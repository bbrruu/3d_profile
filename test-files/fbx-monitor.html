<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FBX æ¨¡å‹è¼‰å…¥ç›£æ§</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .console {
            background: #2d2d2d;
            border: 1px solid #404040;
            padding: 20px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #007acc;
            padding-left: 10px;
        }
        .log-error {
            border-left-color: #f44747;
            color: #f44747;
        }
        .log-success {
            border-left-color: #4ec9b0;
            color: #4ec9b0;
        }
        .log-warning {
            border-left-color: #ffcc02;
            color: #ffcc02;
        }
        .controls {
            background: #252526;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #106ba3;
        }
        .status {
            background: #252526;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            gap: 20px;
        }
        .stat {
            flex: 1;
            text-align: center;
        }
        .stat h3 {
            margin: 0 0 10px 0;
            color: #4ec9b0;
        }
        .stat .value {
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” FBX æ¨¡å‹è¼‰å…¥ç›£æ§</h1>
        
        <div class="controls">
            <button onclick="loadFBXModel()">è¼‰å…¥ FBX æ¨¡å‹</button>
            <button onclick="checkThreeJS()">æª¢æŸ¥ Three.js</button>
            <button onclick="checkFBXLoader()">æª¢æŸ¥ FBXLoader</button>
            <button onclick="clearConsole()">æ¸…é™¤è¨˜éŒ„</button>
            <button onclick="testColorMaterials()">æ¸¬è©¦å½©è‰²æè³ª</button>
        </div>

        <div class="status">
            <div class="stat">
                <h3>è¼‰å…¥ç‹€æ…‹</h3>
                <div id="status" class="value">å¾…æ©Ÿ</div>
            </div>
            <div class="stat">
                <h3>é€²åº¦</h3>
                <div id="progress" class="value">0%</div>
            </div>
            <div class="stat">
                <h3>ç¶²æ ¼æ•¸é‡</h3>
                <div id="meshes" class="value">0</div>
            </div>
            <div class="stat">
                <h3>æè³ªä¿®å¾©</h3>
                <div id="fixes" class="value">0</div>
            </div>
        </div>

        <div class="console" id="console">
            <div class="log-entry">Console å·²å°±ç·’ï¼Œç­‰å¾…è¼‰å…¥...</div>
        </div>
    </div>

    <!-- Three.js åº« -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/fflate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FBXLoader.js"></script>

    <script>
        let meshCount = 0;
        let fixCount = 0;

        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            const time = new Date().toLocaleTimeString();
            entry.innerHTML = `[${time}] ${message}`;
            console.appendChild(entry);
            console.scrollTop = console.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function updateStatus(status) {
            document.getElementById('status').textContent = status;
        }

        function updateProgress(percent) {
            document.getElementById('progress').textContent = percent + '%';
        }

        function updateMeshes(count) {
            document.getElementById('meshes').textContent = count;
            meshCount = count;
        }

        function updateFixes(count) {
            document.getElementById('fixes').textContent = count;
            fixCount = count;
        }

        function clearConsole() {
            document.getElementById('console').innerHTML = '<div class="log-entry">Console å·²æ¸…é™¤</div>';
        }

        function checkThreeJS() {
            if (typeof THREE !== 'undefined') {
                log(`âœ… Three.js å·²è¼‰å…¥ (ç‰ˆæœ¬: ${THREE.REVISION})`, 'success');
            } else {
                log('âŒ Three.js æœªæ‰¾åˆ°', 'error');
            }
        }

        function checkFBXLoader() {
            if (typeof THREE.FBXLoader !== 'undefined') {
                log('âœ… FBXLoader å·²å¯ç”¨', 'success');
            } else {
                log('âŒ FBXLoader æœªæ‰¾åˆ°', 'error');
            }
        }

        function loadFBXModel() {
            if (typeof THREE.FBXLoader === 'undefined') {
                log('âŒ FBXLoader æœªè¼‰å…¥ï¼Œç„¡æ³•é–‹å§‹', 'error');
                return;
            }
            
            updateStatus('è¼‰å…¥ä¸­');
            updateProgress(0);
            updateMeshes(0);
            updateFixes(0);
            
            const loader = new THREE.FBXLoader();
            log('ğŸš€ é–‹å§‹è¼‰å…¥ FBX æ¨¡å‹: models/fuck.fbx');
            
            loader.load(
                'models/fuck.fbx',
                function(object) {
                    log('âœ… FBX æ¨¡å‹è¼‰å…¥æˆåŠŸï¼', 'success');
                    updateStatus('åˆ†æä¸­');
                    
                    let meshes = 0;
                    let fixes = 0;
                    
                    // åˆ†ææ¨¡å‹çµæ§‹
                    object.traverse(function(child) {
                        if (child.isMesh) {
                            meshes++;
                            log(`ğŸ“¦ æ‰¾åˆ°ç¶²æ ¼: ${child.name || 'unnamed'}`);
                            
                            // æª¢æŸ¥æè³ª
                            if (!child.material) {
                                fixes++;
                                log(`ğŸ”§ ä¿®å¾©: ç‚º ${child.name || 'unnamed'} æ·»åŠ æè³ª`, 'warning');
                                child.material = new THREE.MeshLambertMaterial({
                                    color: Math.random() * 0xffffff
                                });
                            } else {
                                log(`âœ… æè³ªOK: ${child.material.type} - #${child.material.color ? child.material.color.getHexString() : 'none'}`);
                                
                                if (child.material.type === 'MeshBasicMaterial') {
                                    fixes++;
                                    log(`ğŸ”§ ä¿®å¾©: è½‰æ› ${child.name || 'unnamed'} ç‚º Lambert æè³ª`, 'warning');
                                }
                                
                                if (child.material.color && child.material.color.r < 0.1 && child.material.color.g < 0.1 && child.material.color.b < 0.1) {
                                    fixes++;
                                    log(`ğŸ”§ ä¿®å¾©: èª¿äº® ${child.name || 'unnamed'} çš„æš—è‰²æè³ª`, 'warning');
                                }
                            }
                        }
                    });
                    
                    updateMeshes(meshes);
                    updateFixes(fixes);
                    updateStatus('å®Œæˆ');
                    updateProgress(100);
                    
                    log(`ğŸ‰ åˆ†æå®Œæˆï¼ç¶²æ ¼: ${meshes}, ä¿®å¾©: ${fixes}`, 'success');
                },
                function(progress) {
                    const percent = progress.total > 0 ? Math.round((progress.loaded / progress.total) * 100) : 0;
                    updateProgress(percent);
                    log(`ğŸ“¥ è¼‰å…¥é€²åº¦: ${percent}%`);
                },
                function(error) {
                    log(`âŒ è¼‰å…¥å¤±æ•—: ${error}`, 'error');
                    updateStatus('å¤±æ•—');
                }
            );
        }

        function testColorMaterials() {
            log('ğŸ¨ æ¸¬è©¦å½©è‰²æè³ªç³»çµ±');
            const colors = [0x4a90e2, 0xe74c3c, 0x2ecc71, 0xf39c12, 0x9b59b6, 0x1abc9c];
            colors.forEach((color, index) => {
                log(`ğŸ¨ é¡è‰² ${index + 1}: #${color.toString(16)}`);
            });
            log('âœ… å½©è‰²æè³ªç³»çµ±æ¸¬è©¦å®Œæˆ', 'success');
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œæª¢æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹æª¢æŸ¥...');
            checkThreeJS();
            checkFBXLoader();
            log('â„¹ï¸ é»æ“Š "è¼‰å…¥ FBX æ¨¡å‹" é–‹å§‹æ¸¬è©¦');
        });
    </script>
</body>
</html>
