<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å»ºç¯‰è¦–è¦ºåŒ–å±•ç¤º - 3D å»ºç¯‰æ¨¡å‹å±•ç¤º</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        .header {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .showcase {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        #viewer {
            width: 100%;
            height: 600px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        .controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .control-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #e74c3c;
        }
        .control-section h3 {
            margin-top: 0;
            color: #f39c12;
        }
        .environment-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .env-btn {
            height: 50px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #333, #555);
            color: white;
        }
        .env-btn:hover {
            border-color: #f39c12;
            transform: scale(1.05);
        }
        .env-btn.daylight { background: linear-gradient(45deg, #87CEEB, #4682B4); }
        .env-btn.sunset { background: linear-gradient(45deg, #FF8C00, #FF4500); }
        .env-btn.night { background: linear-gradient(45deg, #191970, #000080); }
        .env-btn.cloudy { background: linear-gradient(45deg, #708090, #2F4F4F); }
        
        button {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 8px 0;
            border-radius: 25px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        button:hover {
            background: linear-gradient(45deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }
        .info-panel {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .status {
            background: rgba(231, 76, 60, 0.2);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #e74c3c;
            margin: 15px 0;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .feature {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .feature h3 {
            color: #f39c12;
            margin-bottom: 15px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
        }
        .navigation {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }
        .nav-btn {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            text-decoration: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .nav-btn:hover {
            background: rgba(231, 76, 60, 0.7);
        }
        .arch-specs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        .spec-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        .lighting-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="navigation">
        <a href="index.html" class="nav-btn">â† è¿”å›ä¸»é </a>
    </div>

    <div class="header">
        <h1>ğŸ¢ å»ºç¯‰è¦–è¦ºåŒ–å±•ç¤º</h1>
        <p>3D å»ºç¯‰æ¨¡å‹èˆ‡ç’°å¢ƒè¦–è¦ºåŒ– - å°ˆæ¥­å»ºç¯‰è¨­è¨ˆå±•ç¤º</p>
    </div>

    <div class="container">
        <div class="status">
            <h3>ğŸ“Š å»ºç¯‰ç‹€æ…‹</h3>
            <div id="model-status">åˆå§‹åŒ–ä¸­...</div>
        </div>

        <div class="showcase">
            <div id="viewer">
                <div class="loading" id="loading">
                    <h3>ğŸ”„ è¼‰å…¥å»ºç¯‰æ¨¡å‹ä¸­...</h3>
                    <p>è«‹ç¨å€™ï¼Œæ­£åœ¨è¼‰å…¥ 3D å»ºç¯‰æ¨¡å‹</p>
                </div>
            </div>

            <div class="controls">
                <div class="control-section">
                    <h3>ğŸŒ… ç’°å¢ƒå…‰ç…§</h3>
                    <div class="environment-grid">
                        <div class="env-btn daylight" onclick="setEnvironment('daylight')">æ—¥å…‰æ¨¡å¼</div>
                        <div class="env-btn sunset" onclick="setEnvironment('sunset')">é»ƒæ˜æ¨¡å¼</div>
                        <div class="env-btn night" onclick="setEnvironment('night')">å¤œæ™šæ¨¡å¼</div>
                        <div class="env-btn cloudy" onclick="setEnvironment('cloudy')">é™°å¤©æ¨¡å¼</div>
                    </div>
                    <button onclick="randomizeEnvironment()">ğŸ² éš¨æ©Ÿç’°å¢ƒ</button>
                </div>

                <div class="control-section">
                    <h3>ğŸ’¡ å…‰ç…§æ§åˆ¶</h3>
                    <div class="lighting-controls">
                        <button onclick="toggleInteriorLights()">ğŸ  å®¤å…§ç‡ˆå…‰</button>
                        <button onclick="toggleShadows()">ğŸŒ‘ é™°å½±æ•ˆæœ</button>
                    </div>
                    <button onclick="adjustAmbientLight()">â˜€ï¸ ç’°å¢ƒå…‰èª¿æ•´</button>
                </div>

                <div class="control-section">
                    <h3>âš™ï¸ è¦–è§’æ§åˆ¶</h3>
                    <button onclick="resetView()">ğŸ”„ é‡ç½®è¦–è§’</button>
                    <button onclick="toggleWireframe()">ğŸ“ ç·šæ¡†æ¨¡å¼</button>
                    <button onclick="captureScreenshot()">ğŸ“¸ æˆªåœ–</button>
                </div>

                <div class="control-section">
                    <h3>ğŸ”§ å»ºç¯‰å·¥å…·</h3>
                    <button onclick="showFloorPlan()">ğŸ“‹ å¹³é¢åœ–</button>
                    <button onclick="showBuildingSpecs()">ğŸ“ å»ºç¯‰è¦æ ¼</button>
                    <button onclick="exportProject()">ğŸ’¾ åŒ¯å‡ºå°ˆæ¡ˆ</button>
                </div>
            </div>
        </div>

        <div class="features">
            <div class="feature">
                <h3>ğŸ—ï¸ å»ºç¯‰å»ºæ¨¡</h3>
                <p>å°ˆæ¥­çš„ 3D å»ºç¯‰å»ºæ¨¡æœå‹™ï¼Œå¾æ¦‚å¿µè¨­è¨ˆåˆ°å®Œæ•´å»ºç¯‰ï¼Œæä¾›é€¼çœŸçš„è¦–è¦ºåŒ–å±•ç¤ºã€‚</p>
            </div>
            <div class="feature">
                <h3>ğŸŒˆ ç’°å¢ƒæ¸²æŸ“</h3>
                <p>å¤šæ¨£åŒ–çš„ç’°å¢ƒå…‰ç…§è¨­ç½®ï¼ŒåŒ…å«æ—¥å…‰ã€é»ƒæ˜ã€å¤œæ™šç­‰ä¸åŒæ™‚æ®µçš„å…‰ç…§æ•ˆæœã€‚</p>
            </div>
            <div class="feature">
                <h3>ğŸ’¼ å°ˆæ¥­æ‡‰ç”¨</h3>
                <p>é©åˆå»ºç¯‰ææ¡ˆã€è¨­è¨ˆç«¶åœ–ã€å®¢æˆ¶å±•ç¤ºç­‰å°ˆæ¥­ç”¨é€”ï¼Œæå‡å»ºç¯‰è¨­è¨ˆè¡¨ç¾åŠ›ã€‚</p>
            </div>
        </div>

        <div class="info-panel">
            <h3>ğŸ“‹ å»ºç¯‰è¦æ ¼</h3>
            <div class="arch-specs">
                <div class="spec-item">
                    <strong>æª”æ¡ˆæ ¼å¼</strong><br>
                    <span id="file-format">FBX</span>
                </div>
                <div class="spec-item">
                    <strong>ç•¶å‰ç’°å¢ƒ</strong><br>
                    <span id="current-environment">æ—¥å…‰</span>
                </div>
                <div class="spec-item">
                    <strong>å…‰ç…§ç‹€æ…‹</strong><br>
                    <span id="lighting-status">è‡ªç„¶å…‰</span>
                </div>
                <div class="spec-item">
                    <strong>æ¨¡å‹è¤‡é›œåº¦</strong><br>
                    <span id="mesh-count">è¼‰å…¥ä¸­...</span>
                </div>
            </div>
            
            <div id="tech-specs" style="margin-top: 20px;">
                <p><strong>å»ºç¯‰é¡å‹:</strong> ç¾ä»£ä½å®…å»ºç¯‰</p>
                <p><strong>æ¸²æŸ“æ¨¡å¼:</strong> å»ºç¯‰ç´šå…‰ç…§æ¸²æŸ“</p>
                <p><strong>å…‰ç…§ç³»çµ±:</strong> å°ˆæ¥­å»ºç¯‰è¦–è¦ºåŒ–å…‰ç…§</p>
                <p><strong>é©ç”¨é ˜åŸŸ:</strong> å»ºç¯‰è¨­è¨ˆã€å®¤å…§è¨­è¨ˆã€æ™¯è§€è¨­è¨ˆ</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/fflate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, controls;
        let buildingModel;
        let wireframeMode = false;
        let currentEnvironment = 'daylight';
        let ambientLight, directionalLight, interiorLights = [];
        let shadowsEnabled = true;
        let interiorLightsOn = false;

        function updateStatus(message) {
            document.getElementById('model-status').textContent = message;
            console.log(message);
        }

        function init() {
            const container = document.getElementById('viewer');
            
            // æ¸…é™¤è¼‰å…¥æç¤º
            container.innerHTML = '';
            
            // å ´æ™¯è¨­å®š
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // å¤©ç©ºè—
            
            // ç›¸æ©Ÿè¨­å®š
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / 600, 0.1, 1000);
            camera.position.set(10, 8, 15);
            
            // æ¸²æŸ“å™¨è¨­å®š
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, 600);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            container.appendChild(renderer.domElement);
            
            // æ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.5;
            controls.minDistance = 5;
            controls.maxDistance = 50;
            
            // è¨­ç½®å»ºç¯‰ç´šå…‰ç…§
            setupArchitecturalLighting();
            
            // æ·»åŠ åœ°é¢
            const groundGeometry = new THREE.PlaneGeometry(50, 50);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x3e8e41,
                transparent: false
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -1;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // è¼‰å…¥å»ºç¯‰æ¨¡å‹
            loadBuildingModel();
            
            // é–‹å§‹å‹•ç•«
            animate();
        }

        function setupArchitecturalLighting() {
            // ç’°å¢ƒå…‰
            ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);
            
            // ä¸»è¦å¤ªé™½å…‰
            directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight.position.set(20, 20, 10);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -25;
            directionalLight.shadow.camera.right = 25;
            directionalLight.shadow.camera.top = 25;
            directionalLight.shadow.camera.bottom = -25;
            scene.add(directionalLight);
            
            // å¤©ç©ºå…‰
            const skyLight = new THREE.DirectionalLight(0x87CEEB, 0.3);
            skyLight.position.set(-10, 10, -10);
            scene.add(skyLight);
        }

        function loadBuildingModel() {
            updateStatus('è¼‰å…¥å»ºç¯‰æ¨¡å‹ Minnan.fbx...');
            console.log('é–‹å§‹è¼‰å…¥ Minnan.fbx');
            
            // æª¢æŸ¥ FBXLoader æ˜¯å¦å¯ç”¨
            if (typeof THREE.FBXLoader === 'undefined') {
                console.error('FBXLoader æœªè¼‰å…¥');
                updateStatus('âŒ FBXLoader æœªæ‰¾åˆ°ï¼Œä½¿ç”¨æ›¿ä»£æ¨¡å‹...');
                loadAlternativeBuilding();
                return;
            }
            
            console.log('FBXLoader å¯ç”¨ï¼Œé–‹å§‹è¼‰å…¥...');
            const loader = new THREE.FBXLoader();
            
            loader.load(
                'models/Minnan.fbx',
                function(object) {
                    console.log('âœ… Minnan.fbx è¼‰å…¥æˆåŠŸï¼', object);
                    updateStatus('âœ… å»ºç¯‰æ¨¡å‹ Minnan.fbx è¼‰å…¥æˆåŠŸï¼');
                    
                    buildingModel = object;
                    
                    // æª¢æŸ¥æ¨¡å‹å…§å®¹
                    let meshCount = 0;
                    object.traverse(function(child) {
                        if (child.isMesh) {
                            meshCount++;
                            console.log(`ç™¼ç¾å»ºç¯‰ç¶²æ ¼ ${meshCount}:`, child.name, child.geometry, child.material);
                        }
                    });
                    console.log(`å»ºç¯‰ç¸½å…±ç™¼ç¾ ${meshCount} å€‹ç¶²æ ¼`);
                    
                    // ç‚ºå»ºç¯‰æ·»åŠ æè³ª
                    buildingModel.traverse(function(child) {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            
                            // å»ºç¯‰æè³ªè™•ç†
                            try {
                                if (!child.material) {
                                    console.log('å»ºç¯‰ç¶²æ ¼ç„¡æè³ªï¼Œæ·»åŠ é è¨­å»ºç¯‰æè³ª');
                                    child.material = new THREE.MeshLambertMaterial({
                                        color: 0xf0f0f0
                                    });
                                } else if (Array.isArray(child.material)) {
                                    console.log('è™•ç†å»ºç¯‰æè³ªé™£åˆ—');
                                    child.material = child.material.map(mat => {
                                        if (mat && mat.clone) {
                                            return mat.clone();
                                        }
                                        return new THREE.MeshLambertMaterial({
                                            color: 0xf0f0f0
                                        });
                                    });
                                } else {
                                    console.log('ä¿æŒåŸå§‹å»ºç¯‰æè³ª');
                                    // ä¿æŒåŸå§‹å»ºç¯‰æè³ªï¼Œå¦‚æœå¯èƒ½çš„è©±
                                    if (child.material.clone) {
                                        child.material = child.material.clone();
                                    }
                                }
                            } catch (error) {
                                console.log('å»ºç¯‰æè³ªè™•ç†éŒ¯èª¤:', error);
                                child.material = new THREE.MeshLambertMaterial({
                                    color: 0xf0f0f0
                                });
                            }
                        }
                    });
                    
                    // è¨­ç½®å»ºç¯‰æ¨¡å‹
                    setupBuildingModel();
                    
                    // æ›´æ–°è¦æ ¼è³‡è¨Š
                    document.getElementById('mesh-count').textContent = meshCount;
                    document.getElementById('lighting-status').textContent = 'è‡ªç„¶å…‰';
                    
                    updateStatus('ğŸ¢ Minnan.fbx å»ºç¯‰å±•ç¤ºå·²å°±ç·’ï¼');
                },
                function(progress) {
                    if (progress.lengthComputable) {
                        const percent = Math.round((progress.loaded / progress.total) * 100);
                        updateStatus(`è¼‰å…¥é€²åº¦: ${percent}%`);
                        console.log(`å»ºç¯‰è¼‰å…¥é€²åº¦: ${percent}%`);
                    } else {
                        updateStatus('è¼‰å…¥ä¸­...');
                    }
                },
                function(error) {
                    console.error('âŒ Minnan.fbx è¼‰å…¥å¤±æ•—:', error);
                    updateStatus('âŒ Minnan.fbx è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨æ›¿ä»£å»ºç¯‰æ¨¡å‹...');
                    loadAlternativeBuilding();
                }
            );
        }

        function loadAlternativeBuilding() {
            updateStatus('å‰µå»ºå»ºç¯‰ç¤ºç¯„æ¨¡å‹...');
            
            // å‰µå»ºç°¡å–®çš„å»ºç¯‰æ¨¡å‹
            buildingModel = new THREE.Group();
            
            // ä¸»å»ºç¯‰é«”
            const buildingGeometry = new THREE.BoxGeometry(8, 6, 10);
            const buildingMaterial = new THREE.MeshLambertMaterial({ color: 0xf0f0f0 });
            const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
            building.position.y = 3;
            building.castShadow = true;
            building.receiveShadow = true;
            buildingModel.add(building);
            
            // å±‹é ‚
            const roofGeometry = new THREE.ConeGeometry(6, 3, 4);
            const roofMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const roof = new THREE.Mesh(roofGeometry, roofMaterial);
            roof.position.y = 7.5;
            roof.rotation.y = Math.PI / 4;
            roof.castShadow = true;
            buildingModel.add(roof);
            
            // é–€
            const doorGeometry = new THREE.BoxGeometry(1.5, 3, 0.1);
            const doorMaterial = new THREE.MeshLambertMaterial({ color: 0x654321 });
            const door = new THREE.Mesh(doorGeometry, doorMaterial);
            door.position.set(0, 1.5, 5.1);
            buildingModel.add(door);
            
            // çª—æˆ¶
            for (let i = 0; i < 4; i++) {
                const windowGeometry = new THREE.BoxGeometry(1, 1, 0.1);
                const windowMaterial = new THREE.MeshLambertMaterial({ color: 0x87CEEB });
                const window = new THREE.Mesh(windowGeometry, windowMaterial);
                window.position.set((i - 1.5) * 2, 4, 5.1);
                buildingModel.add(window);
            }
            
            setupBuildingModel();
            
            document.getElementById('mesh-count').textContent = '6';
            document.getElementById('file-format').textContent = 'ç¤ºç¯„å»ºç¯‰';
            
            updateStatus('âœ… å»ºç¯‰ç¤ºç¯„æ¨¡å‹å·²å°±ç·’ï¼');
        }

        function setupBuildingModel() {
            // è¨ˆç®—é‚Šç•Œæ¡†å’Œç¸®æ”¾
            const box = new THREE.Box3().setFromObject(buildingModel);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            
            const maxDim = Math.max(size.x, size.y, size.z);
            const scale = 8 / maxDim;
            buildingModel.scale.setScalar(scale);
            
            // é‡æ–°è¨ˆç®—ç¸®æ”¾å¾Œçš„ä¸­å¿ƒé»
            const scaledBox = new THREE.Box3().setFromObject(buildingModel);
            const scaledCenter = scaledBox.getCenter(new THREE.Vector3());
            
            // å°‡å»ºç¯‰æ”¾åœ¨åœ°é¢ä¸Š
            buildingModel.position.set(
                -scaledCenter.x,
                -scaledBox.min.y,
                -scaledCenter.z
            );
            
            scene.add(buildingModel);
        }

        function setEnvironment(envType) {
            currentEnvironment = envType;
            
            switch(envType) {
                case 'daylight':
                    scene.background = new THREE.Color(0x87CEEB);
                    directionalLight.color.setHex(0xffffff);
                    directionalLight.intensity = 1.2;
                    ambientLight.intensity = 0.4;
                    break;
                case 'sunset':
                    scene.background = new THREE.Color(0xFF8C00);
                    directionalLight.color.setHex(0xFF4500);
                    directionalLight.intensity = 0.8;
                    ambientLight.intensity = 0.3;
                    break;
                case 'night':
                    scene.background = new THREE.Color(0x191970);
                    directionalLight.color.setHex(0x4169E1);
                    directionalLight.intensity = 0.3;
                    ambientLight.intensity = 0.1;
                    break;
                case 'cloudy':
                    scene.background = new THREE.Color(0x708090);
                    directionalLight.color.setHex(0xD3D3D3);
                    directionalLight.intensity = 0.6;
                    ambientLight.intensity = 0.5;
                    break;
            }
            
            document.getElementById('current-environment').textContent = envType;
            updateStatus(`ç’°å¢ƒå·²æ›´æ”¹ç‚º ${envType}`);
        }

        function randomizeEnvironment() {
            const environments = ['daylight', 'sunset', 'night', 'cloudy'];
            const randomEnv = environments[Math.floor(Math.random() * environments.length)];
            setEnvironment(randomEnv);
        }

        function toggleInteriorLights() {
            interiorLightsOn = !interiorLightsOn;
            
            if (interiorLightsOn) {
                // æ·»åŠ å®¤å…§ç‡ˆå…‰
                for (let i = 0; i < 3; i++) {
                    const light = new THREE.PointLight(0xFFFACD, 0.5, 10);
                    light.position.set((i - 1) * 3, 4, 0);
                    scene.add(light);
                    interiorLights.push(light);
                }
                document.getElementById('lighting-status').textContent = 'å®¤å…§ç‡ˆå…‰é–‹å•Ÿ';
                updateStatus('å®¤å…§ç‡ˆå…‰å·²é–‹å•Ÿ');
            } else {
                // ç§»é™¤å®¤å…§ç‡ˆå…‰
                interiorLights.forEach(light => scene.remove(light));
                interiorLights = [];
                document.getElementById('lighting-status').textContent = 'è‡ªç„¶å…‰';
                updateStatus('å®¤å…§ç‡ˆå…‰å·²é—œé–‰');
            }
        }

        function toggleShadows() {
            shadowsEnabled = !shadowsEnabled;
            renderer.shadowMap.enabled = shadowsEnabled;
            
            if (buildingModel) {
                buildingModel.traverse(function(child) {
                    if (child.isMesh) {
                        child.castShadow = shadowsEnabled;
                        child.receiveShadow = shadowsEnabled;
                    }
                });
            }
            
            updateStatus(shadowsEnabled ? 'é™°å½±æ•ˆæœå·²é–‹å•Ÿ' : 'é™°å½±æ•ˆæœå·²é—œé–‰');
        }

        function adjustAmbientLight() {
            ambientLight.intensity = ambientLight.intensity > 0.5 ? 0.2 : ambientLight.intensity + 0.1;
            updateStatus(`ç’°å¢ƒå…‰å¼·åº¦: ${ambientLight.intensity.toFixed(1)}`);
        }

        function resetView() {
            camera.position.set(10, 8, 15);
            controls.target.set(0, 0, 0);
            controls.autoRotate = true;
            controls.update();
            updateStatus('è¦–è§’å·²é‡ç½®');
        }

        function toggleWireframe() {
            if (!buildingModel) return;
            
            wireframeMode = !wireframeMode;
            
            buildingModel.traverse(function(child) {
                if (child.isMesh && child.material) {
                    if (Array.isArray(child.material)) {
                        child.material.forEach(mat => {
                            mat.wireframe = wireframeMode;
                            mat.needsUpdate = true;
                        });
                    } else {
                        child.material.wireframe = wireframeMode;
                        child.material.needsUpdate = true;
                    }
                }
            });
            
            updateStatus(wireframeMode ? 'å·²é–‹å•Ÿç·šæ¡†æ¨¡å¼' : 'å·²é—œé–‰ç·šæ¡†æ¨¡å¼');
        }

        function captureScreenshot() {
            const wasAutoRotating = controls.autoRotate;
            controls.autoRotate = false;
            
            renderer.render(scene, camera);
            
            const canvas = renderer.domElement;
            const link = document.createElement('a');
            link.download = `architecture-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            controls.autoRotate = wasAutoRotating;
            updateStatus('ğŸ“¸ å»ºç¯‰æˆªåœ–å·²ä¿å­˜');
        }

        function showFloorPlan() {
            alert('å¹³é¢åœ–åŠŸèƒ½ï¼š\n\né€™è£¡å¯ä»¥å±•ç¤ºå»ºç¯‰çš„å¹³é¢é…ç½®åœ–\nåŒ…å«æˆ¿é–“å¸ƒå±€ã€åŠŸèƒ½åˆ†å€ç­‰è³‡è¨Š\n\næ­¤åŠŸèƒ½å¯ä»¥æ•´åˆ 2D å¹³é¢åœ–é¡¯ç¤º');
        }

        function showBuildingSpecs() {
            if (!buildingModel) {
                alert('è«‹å…ˆè¼‰å…¥å»ºç¯‰æ¨¡å‹');
                return;
            }
            
            const box = new THREE.Box3().setFromObject(buildingModel);
            const size = box.getSize(new THREE.Vector3());
            
            let meshCount = 0;
            buildingModel.traverse(function(child) {
                if (child.isMesh) meshCount++;
            });
            
            const specs = `å»ºç¯‰è¨­è¨ˆè¦æ ¼è³‡è¨Š:
            
ğŸ“Š åŸºæœ¬è³‡è¨Š:
â€¢ å»ºç¯‰é¡å‹: ç¾ä»£ä½å®…
â€¢ æ¨¡å‹æ ¼å¼: FBX
â€¢ å…ƒä»¶æ•¸é‡: ${meshCount}

ğŸ“ å»ºç¯‰å°ºå¯¸:
â€¢ å¯¬åº¦: ${size.x.toFixed(2)} å–®ä½
â€¢ é«˜åº¦: ${size.y.toFixed(2)} å–®ä½
â€¢ æ·±åº¦: ${size.z.toFixed(2)} å–®ä½

ğŸ¯ è¨­è¨ˆç‰¹è‰²:
â€¢ å…‰ç…§ç³»çµ±: å»ºç¯‰ç´šæ¸²æŸ“
â€¢ ç’°å¢ƒæ•ˆæœ: å¤šæ™‚æ®µå…‰ç…§
â€¢ æè³ªç³»çµ±: çœŸå¯¦å»ºç¯‰æè³ª

ğŸ’¼ æ‡‰ç”¨ç¯„åœ:
â€¢ å»ºç¯‰ææ¡ˆ
â€¢ è¨­è¨ˆç«¶åœ–
â€¢ å®¢æˆ¶å±•ç¤º
â€¢ è¦åŠƒå¯©æŸ¥`;
            
            alert(specs);
        }

        function exportProject() {
            const projectData = {
                environment: currentEnvironment,
                wireframe: wireframeMode,
                shadows: shadowsEnabled,
                interiorLights: interiorLightsOn,
                ambientIntensity: ambientLight.intensity,
                cameraPosition: {
                    x: camera.position.x,
                    y: camera.position.y,
                    z: camera.position.z
                },
                timestamp: new Date().toISOString(),
                projectType: 'architecture'
            };
            
            const dataStr = JSON.stringify(projectData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'architecture-project.json';
            link.click();
            
            URL.revokeObjectURL(url);
            updateStatus('ğŸ’¾ å»ºç¯‰å°ˆæ¡ˆå·²åŒ¯å‡º');
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (controls) {
                controls.update();
            }
            
            renderer.render(scene, camera);
        }

        // åˆå§‹åŒ–
        init();
        updateStatus('å»ºç¯‰è¦–è¦ºåŒ–ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>
